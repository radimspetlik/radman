{% extends "base.html" %}
{% block title %}Radiopharmaceutical Management{% endblock %}
{% block content %}
<style>
  /* Responsive Table Styles */
  #record-list {
      margin: auto;
      overflow-x: auto;
      width: 100%;
      max-width: 800px; /* Adjust as needed */
  }
  .record-header, .record-row {
      display: flex;
      flex-wrap: wrap;
      border-bottom: 1px solid #ddd;
      padding: 8px 0;
  }
  .record-header .cell {
      font-weight: bold;
  }
  .cell {
      flex: 1;
      padding: 0 10px;
      min-width: 120px;
      box-sizing: border-box;
  }
  /* Ensure the form container doesn't get obscured by the fixed button */
  #radiopharm-form {
      padding-bottom: 70px;
  }
  /* Fixed Save Button at the bottom center */
  #save-button {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 800px; /* Must match #record-list max-width */
      background-color: #007BFF;
      color: white;
      border: none;
      padding: 15px 0;
      text-align: center;
      font-size: 1.2em;
      z-index: 1000;
  }
  /* Optional: basic hover and focus states for the button */
  #save-button:hover,
  #save-button:focus {
      background-color: #0056b3;
      cursor: pointer;
  }
</style>

<h2>Manage Radiopharmaceuticals for {{ current_user.username }}</h2>

<form method="POST" action="{{ url_for('radiopharm.manage') }}" id="radiopharm-form">
  <div id="record-list">
    <!-- Table Header -->
    <div class="record-header">
      <div class="cell pharmaceutical">Pharmaceutical</div>
      <div class="cell available">Is Available?</div>
      <div class="cell price">Price per 1GBq</div>
      <div class="cell time-slots">Time Slots</div>
    </div>

    {% for record in records %}
      <div class="record-row" data-index="{{ loop.index0 }}">
        <!-- Pharmaceutical Name (RowKey) -->
        <div class="cell pharmaceutical">
          {{ record.type }}
          <input type="hidden" name="records[{{ loop.index0 }}][type]" value="{{ record.type }}">
        </div>

        <!-- Available Checkbox -->
        <div class="cell available">
          <input type="checkbox" name="records[{{ loop.index0 }}][available]"
                 {% if record.available %} checked {% endif %} />
        </div>

        <!-- Price -->
        <div class="cell price">
          <input type="number" step="0.01" name="records[{{ loop.index0 }}][price]" value="{{ record.price }}">
        </div>

        <!-- Multi-select for Time Slots -->
        <div class="cell time-slots">
          <select name="records[{{ loop.index0 }}][time_slots][]" multiple style="width: 100%">
            <option value="anytime" {% if 'anytime' in record.time_slots %} selected {% endif %}>anytime</option>
            {% for hour in range(6, 17) %}
              {% set h00 = "%d:00"|format(hour) %}
              {% set h30 = "%d:30"|format(hour) %}
              <option value="{{ h00 }}" {% if h00 in record.time_slots %} selected {% endif %}>{{ h00 }}</option>
              <option value="{{ h30 }}" {% if h30 in record.time_slots %} selected {% endif %}>{{ h30 }}</option>
            {% endfor %}
            <option value="17:00" {% if '17:00' in record.time_slots %} selected {% endif %}>17:00</option>
          </select>
          <br>
{#          <small>Hold Ctrl (Windows) or Cmd (Mac) to select multiple times.</small>#}
        </div>
      </div>
    {% endfor %}
  </div>
</form>

<!-- Fixed, always visible Save button -->
<button type="submit" form="radiopharm-form" id="save-button">Save</button>
{% endblock %}
