{% extends "base.html" %}

{% block title %}Manage PET Radiotracer Dosing Schemes{% endblock %}

{% block content %}
  <h1>Manage PET Radiotracer Dosing Schemes</h1>

  {% if action == 'add' %}
    <h2>Add New Dosing Scheme</h2>
    <form method="post" action="{{ url_for('dosing_schemes.add_dosing_scheme') }}" class="dosing-scheme-form">
      <div class="form-group">
        <label for="radiopharmaceutical">Radiopharmaceutical:</label>
        <select name="radiopharmaceutical" id="radiopharmaceutical" required class="form-control">
          <option value="">Select a Radiopharmaceutical</option>
          {% for rad in radiopharmaceuticals %}
            <option value="{{ rad.type }}">{{ rad.type }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="name">Scheme Name:</label>
        <input type="text" name="name" id="name" required class="form-control">
      </div>
      <div class="form-group">
        <label for="dose_value">Dose Value (MBq):</label>
        <input type="number" step="any" name="dose_value" id="dose_value" required class="form-control">
      </div>
      <div class="form-group">
        <label for="dose_type">Dose Type:</label>
        <select name="dose_type" id="dose_type" class="form-control">
          <option value="per_kg">per kg</option>
          <option value="fixed">fixed</option>
        </select>
      </div>
      <div class="form-group">
        <label for="uptake1">Uptake 1 (min):</label>
        <input type="number" name="uptake1" id="uptake1" required class="form-control">
      </div>
      <div class="form-group">
        <label for="imaging1">Imaging 1 (min):</label>
        <input type="number" name="imaging1" id="imaging1" required class="form-control">
      </div>
      <div class="form-group">
        <label for="uptake2">Uptake 2 (min):</label>
        <input type="number" name="uptake2" id="uptake2" class="form-control">
      </div>
      <div class="form-group">
        <label for="imaging2">Imaging 2 (min):</label>
        <input type="number" name="imaging2" id="imaging2" class="form-control">
      </div>
      <button type="submit" class="btn btn-primary">Add Dosing Scheme</button>
    </form>


  {% elif action == 'edit' and scheme %}
    <h2>Edit Dosing Scheme</h2>
    <form method="post" action="{{ url_for('dosing_schemes.edit_dosing_scheme', row_key=scheme.RowKey) }}" class="dosing-scheme-form">
      <div class="form-group">
        <label for="radiopharmaceutical">Radiopharmaceutical:</label>
        <select name="radiopharmaceutical" id="radiopharmaceutical" required class="form-control">
          <option value="">Select a Radiopharmaceutical</option>
          {% for rad in radiopharmaceuticals %}
            <option value="{{ rad.RowKey }}" {% if scheme.Radiopharmaceutical == rad.RowKey %}selected{% endif %}>{{ rad.type }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="name">Scheme Name:</label>
        <input type="text" name="name" id="name" value="{{ scheme.Name }}" required class="form-control">
      </div>
      <div class="form-group">
        <label for="dose_value">Dose Value (MBq):</label>
        <input type="number" step="any" name="dose_value" id="dose_value" value="{{ scheme.DoseValue }}" required class="form-control">
      </div>
      <div class="form-group">
        <label for="dose_type">Dose Type:</label>
        <select name="dose_type" id="dose_type" class="form-control">
          <option value="per_kg" {% if scheme.DoseType == "per_kg" %}selected{% endif %}>per kg</option>
          <option value="fixed" {% if scheme.DoseType == "fixed" %}selected{% endif %}>fixed</option>
        </select>
      </div>
      <div class="form-group">
        <label for="uptake1">Uptake 1 (min):</label>
        <input type="number" name="uptake1" id="uptake1" value="{{ scheme.Uptake1 }}" required class="form-control">
      </div>
      <div class="form-group">
        <label for="imaging1">Imaging 1 (min):</label>
        <input type="number" name="imaging1" id="imaging1" value="{{ scheme.Imaging1 }}" required class="form-control">
      </div>
      <div class="form-group">
        <label for="uptake2">Uptake 2 (min):</label>
        <input type="number" name="uptake2" id="uptake2" value="{{ scheme.Uptake2 }}" class="form-control">
      </div>
      <div class="form-group">
        <label for="imaging2">Imaging 2 (min):</label>
        <input type="number" name="imaging2" id="imaging2" value="{{ scheme.Imaging2 }}" class="form-control">
      </div>
      <button type="submit" class="btn btn-primary">Update Dosing Scheme</button>
    </form>


  {% else %}
    <h2>Your Dosing Schemes</h2>
    <a href="{{ url_for('dosing_schemes.add_dosing_scheme') }}" class="btn btn-edit">Add New Scheme</a>
    <table>
      <thead>
        <tr>
          <th>Radiopharm.</th>
          <th>Name</th>
          <th style="min-width: 100px;">Dose</th>
          <th>UP1</th>
          <th>IMG1</th>
          <th>UP2</th>
          <th>IMG2</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for scheme in schemes %}
          <tr>
            <td>{{ scheme.Radiopharmaceutical }}</td>
            <td>{{ scheme.Name }}</td>
            <td>
              {{ scheme.DoseValue }} MBq{% if scheme.DoseType == 'per_kg' %}/kg{% endif %}
            </td>
            <td>{{ scheme.Uptake1 }}</td>
            <td>{{ scheme.Imaging1 }}</td>
            <td>{{ scheme.Uptake2 }}</td>
            <td>{{ scheme.Imaging2 }}</td>
            <td>
              <div class="action-buttons">
                <div style="display: flex; gap: 5px; align-items: stretch;">
                  <div style="flex: 1;">
                    <a href="{{ url_for('dosing_schemes.edit_dosing_scheme', row_key=scheme.RowKey) }}" style="display: block; width: 100%;">
                      <button type="button" class="btn btn-edit" style="width: 100%;">Edit</button>
                    </a>
                  </div>
                  <div style="flex: 1;">
                    <form method="post" action="{{ url_for('dosing_schemes.delete_dosing_scheme', row_key=scheme.RowKey) }}" style="display:inline;">
                      <button type="submit" onclick="return confirm('Are you sure you want to delete this dosing scheme?');" class="btn btn-delete" style="width: 100%;">Delete</button>
                    </form>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="8">No dosing schemes found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
{% endblock %}
